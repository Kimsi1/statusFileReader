
<html class="no-js" lang="">

    <head>
      <meta charset="utf-8">
      <title>Package info</title>
      <meta name="description" content="">
      <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <meta name="theme-color" content="#fafafa">
      <style>
        table {
          
          font-family: helvetica;
          text-decoration: none;
          border-collapse: collapse;
          width: 100%;
        }
        
        td, th {
          border: 1px solid #dddddd;
          text-align: left;
          padding: 8px;
        }
        
        tr:nth-child(even) {
          background-color: #dddddd;
        }
        </style>
    </head>
    
    <body>
      <table>
        <tr>
          <th>Label</th>
          <th>Data</th>
          
        </tr>
        <tr>
          <td>Name:</td>
          <td id="name"></td>
          
        </tr>
        <tr>
          <td>Depends:</td>
          <td id="depends"></td>
        
        </tr>
        <tr>
          <td>Reverse depends:</td>
          <td id="revDepends"></td>
          
        </tr>
        <tr>
          <td>Description:</td>
          <td id="description"></td>
          
        </tr>
        
      </table>
      <script>
        
        // Sends the name of the package as a POST request to the backend.
        let savePackageName=async(event, name)=>{
          event.preventDefault();
          let url = "http://localhost:3000/packages/"+name;
          fetch(url, {method: "POST"}).then(() => {
            location.href = event.target.href;
          });
        }




        let allNames = [];
        // This is called when the page is loaded.
        const loadPackages = () => {

          // Get all of the packages from backend and save their names on an array.
          fetch('http://localhost:3000/packages/')
            .then((response) => {
              return response.json();
            })
            .then((myJson) => {
              for(package of myJson){
                allNames.push(package.name);
              }
              
              // Get the package that the user clicked
              fetch('http://localhost:3000/packages/name')
                .then((response) => {
                  return response.json();
                })
                .then((myJson) => {

                  // Insert package name and description into the html table.
                  let name = document.getElementById("name");
                  name.innerHTML = myJson.name;
                  let description = document.getElementById("description");
                  description.innerHTML = myJson.description;  

                  // Insert dependensies into the html table.
                  let depends = document.getElementById("depends");
                  if(myJson.depends==='No dependencies.'){
                    depends.innerHTML = myJson.depends; 
                  } else {

                    for (let package of myJson.depends) {
                      
                      // If there is a pipe character, deal with the linking.
                      if(package.toString().includes(' | ')){
                        let splitList = package.toString().split(' | ');
                        
                        for(let i=0;i<splitList.length;i++){
                          // There might be a '\r' when run in windows OS, so it is removed.
                          let key = splitList[i].split('\r')
                          // If the package name list includes the dependency name, create a link to the it.
                          if(allNames.includes(key[0])){
                            // If there are more items, put a '|' character to the end
                            if(i<splitList.length-1){
                              const x = `
                                <a href="http://localhost:3000/packagehtml" onclick="javascript:savePackageName(event, '${key[0]}')">${key[0]}</a> |
                              `
                              document.getElementById('depends').innerHTML = document.getElementById('depends').innerHTML + x;
                            } else {
                              const x = `
                                <a href="http://localhost:3000/packagehtml" onclick="javascript:savePackageName(event, '${key[0]}')">${key[0]}</a>
                              `
                              document.getElementById('depends').innerHTML = document.getElementById('depends').innerHTML + x;
                            }
                          } else {
                            // Name was not found in the package name list, so no link will be created.
                            if(i<splitList.length-1){
                              const x = `
                              ${splitList[i]} |
                              `
                              document.getElementById('depends').innerHTML = document.getElementById('depends').innerHTML + x;
                            } else {
                              const x = `
                              ${splitList[i]}
                              `
                              document.getElementById('depends').innerHTML = document.getElementById('depends').innerHTML + x;
                            }
                          }  
                        }

                      } else {
                        // No pipe character was found in dependency entry.
                        // If the package name list includes the dependency name, create a link to the it.
                        if(allNames.includes(package.toString())){
                          const x = `
                              <p><a href="http://localhost:3000/packagehtml" onclick="javascript:savePackageName(event, '${package}')">${package}</a></p>
                          `
                          document.getElementById('depends').innerHTML = document.getElementById('depends').innerHTML + x;
                        } else {
                          // Name was not found in the package name list, so no link will be created.
                          const x = `
                              <p>${package}</p>
                          `
                          document.getElementById('depends').innerHTML = document.getElementById('depends').innerHTML + x;
                        }  
                      } 
                    }
                  }


              let revDepends = document.getElementById("revDepends");
              if(myJson.revDepends==='No reverse dependencies'){
                revDepends.innerHTML = myJson.revDepends;
              } else {
                for (let package of myJson.revDepends) {
                    const x = `
                        <p><a href="http://localhost:3000/packagehtml" onclick="javascript:savePackageName(event, '${package}')">${package}</a></p>
                    `
                    document.getElementById('revDepends').innerHTML = document.getElementById('revDepends').innerHTML + x;
                }
              }


              
          });
        
        })
          }
      
        
        loadPackages();
        
      </script>
    </body>
    
    </html>